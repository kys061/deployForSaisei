"use strict";var reportApp=angular.module("reportApp",["ngRoute","base64","chart.js","angular-momentjs","angular-loading-bar","angularjs-datetime-picker","angularjs-dropdown-multiselect","ui-notification"]).config(["cfpLoadingBarProvider",function(cfpLoadingBarProvider){cfpLoadingBarProvider.latencyThreshold=400,cfpLoadingBarProvider.parentSelector="#loading-bar-container",cfpLoadingBarProvider.spinnerTemplate='<div id="loading-bar"><div id="loading-bar-spinner"><div class="spinner-icon"></div></div></div>'}]).config(function($routeProvider,$locationProvider,$momentProvider){$momentProvider.asyncLoading(!1).scriptUrl("./lib/moment.min.js"),$routeProvider.when("/report",{templateUrl:"templates/report.html",controller:"ReportCtrl"}).otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!0)}).run(function($rootScope){$rootScope.users_app_top1=[]}).constant("_",window._);reportApp.controller("MainCtrl",function($scope,$log,$route,$templateCache,$location,$window,$q,_,SharedData,ReportMain,ReportMainMetaData){var from,until,complete_count;new $window.Sugar.Date(new Date);$scope.report_def={1:"int_report",2:"user_report",3:"user_group_report"},$scope.select2model=[],$scope.select2data=[{id:1,label:"인터페이스 트래픽"},{id:2,label:"사용자 트래픽"},{id:3,label:"사용자 그룹 트래픽"}],$scope.select2settings={},$scope.$watch("select2model",function(val){}),$scope.currentState=!0,$scope.currentDurationState=SharedData.currentDurationState,$scope.$watch("date_from",function(val){from=val}),$scope.$watch("date_until",function(val){until=val});$q(function(resolve,reject){(new ReportMainMetaData).q_metaLinkData().then(function(val){$scope.hostname=val.hostname,resolve({hostname:$scope.hostname})},function(val){reject(Error("failure!!"))})}).then(function(val){var hostname=val.hostname;ReportMain.getUserGroupSize(hostname).then(function(size){$scope.group_size=size.data.size,ReportMain.getUserSize(hostname).then(function(size){$scope.users_size=size.data.size},function(val){notie.alert({type:"error",text:"사용자 그룹 정보를 가지고 올 수 없습니다!!!"})})},function(val){notie.alert({type:"error",text:"사용자 그룹 정보를 가지고 올 수 없습니다!!!"})})},function(val){}),$scope.sendDate=function(){var duration=$window.Sugar.Date.range(from,until).every("days").length;$scope.report_type=[];for(var i=0;i<$scope.select2model.length;i++)$scope.report_type.push({name:$scope.report_def[$scope.select2model[i].id],status:!0});var _until=new $window.Sugar.Date(until),_from=new $window.Sugar.Date(from);if(void 0===from||void 0===until)notie.alert({type:"error",text:"리포트 기간을 넣어주세요!!!"});else if(duration>31)notie.alert({type:"error",text:"리포트 기간은 최대 한달까지 가능합니다!!"});else if(_until.isFuture().raw)notie.alert({type:"error",text:"리포트 종료 시점은 현재보다 미래로 설정할 수 없습니다!!"});else if(_from.isFuture().raw)notie.alert({type:"error",text:"리포트 시작 시점은 현재보다 미래로 설정할 수 없습니다!!"});else if($scope.select2model.length>0){var count_group=0,count_users=0;_($scope.select2model).each(function(elem,index){3===elem.id&&(count_group+=1),2===elem.id&&(count_users+=1)}),$scope.group_size>0&&$scope.users_size>0?(complete_count=21+$scope.group_size,$scope.currentState=!1,$scope.currentDurationState=!1,SharedData.setFrom(from),SharedData.setUntil(until),SharedData.setSelect2model($scope.select2model),SharedData.setReportType($scope.report_type),$location.path("/report")):$scope.group_size>0&&$scope.users_size<=0?count_users>0?notie.alert({type:"error",text:"사이세이 내에 사용자가 존재 하지 않습니다. 사용자 트래픽은 해제해 주십시요!!!"}):($scope.currentState=!1,$scope.currentDurationState=!1,SharedData.setFrom(from),SharedData.setUntil(until),SharedData.setSelect2model($scope.select2model),SharedData.setReportType($scope.report_type),$location.path("/report")):$scope.group_size<=0&&$scope.users_size>0?count_group>0?notie.alert({type:"error",text:"사이세이 내에 사용자 그룹이 존재 하지 않습니다. 사용자 그룹은 해제해 주십시요!!!"}):($scope.currentState=!1,$scope.currentDurationState=!1,SharedData.setFrom(from),SharedData.setUntil(until),SharedData.setSelect2model($scope.select2model),SharedData.setReportType($scope.report_type),$location.path("/report")):count_group>0?notie.alert({type:"error",text:"사이세이 내에 사용자 그룹이 존재 하지 않습니다. 사용자 그룹 트래픽은 해제해 주십시요!!!"}):count_users>0?notie.alert({type:"error",text:"사이세이 내에 사용자가 존재 하지 않습니다. 사용자 트래픽은 해제해 주십시요!!!"}):($scope.currentState=!1,$scope.currentDurationState=!1,SharedData.setFrom(from),SharedData.setUntil(until),SharedData.setSelect2model($scope.select2model),SharedData.setReportType($scope.report_type),$location.path("/report"))}else notie.alert({type:"error",text:"최소 하나의 리포트를 선택해주세요!"})}}),reportApp.controller("ReportCtrl",function($rootScope,$scope,$log,_,ReportData,SharedData,UserAppData,$location,$route,$window,cfpLoadingBar,$q,$timeout,ReportInterfaceData,ReportUserData,ReportMetaData,ReportIntName,ReportUserGroupData,Notification){$scope.$on("$routeChangeStart",function(scope,next,current){SharedData.setCurrentState(!0),$location.path("/"),$window.location.href="/report/"});$scope.complete_check_count=43,$scope.loaded_count=0,$scope.started_count=0,$scope.created_time=(new Date).toLocaleString("ko-KR",{hour12:!1}).replace("시 ",":").replace("분 ",":").replace("초",""),$rootScope.$on("cfpLoadingBar:loading",function(){$scope.started_count+=1}),$rootScope.$on("cfpLoadingBar:loaded",function(){$scope.loaded_count+=1}),$rootScope.$on("cfpLoadingBar:completed",function(){});var from=SharedData.getFrom(),until=SharedData.getUntil(),report_type=(SharedData.getSelect2model(),SharedData.getReportType());$scope.grpState=[{name:"int_report",state:!1},{name:"user_report",state:!1},{name:"user_group_report",state:!1}],$scope.segState=[{name:"seg1",state:!1},{name:"seg2",state:!1}];for(var k=0;k<report_type.length;k++)if(report_type[k].status)for(var j=0;j<$scope.grpState.length;j++)$scope.grpState[j].name===report_type[k].name&&($scope.grpState[j].state=!0);$scope.getGraphState=function(arr,name){for(var i=0;i<arr.length;i++)if(arr[i].name===name)return!0===arr[i].state},$scope.getSegState=function(arr,name){for(var i=0;i<arr.length;i++)if(arr[i].name===name)return!0===arr[i].state};$q(function(resolve,reject){(new ReportMetaData).q_metaLinkData().then(function(val){$scope.intLink=val.int_link,$scope.hostname=val.hostname,(new ReportIntName).q_intName($scope.hostname).then(function(val){resolve({hostname:$scope.hostname,int_ext_name:val.int_ext_name,int_int_name:val.int_int_name,use_span:!1})},function(val){reject(Error("failure!!"))})},function(val){reject(Error("failure!!"))})}).then(function(val){var hostname=val.hostname;if(val.int_ext_name.length>1){var first_seg_int_ext_name=val.int_ext_name[0],second_seg_int_ext_name=val.int_ext_name[1],first_seg_int_int_name=val.int_int_name[0],second_seg_int_int_name=val.int_int_name[1];_.each($scope.segState,function(state){state.state=!0}),(firstSegIntGrpDataset=new ReportInterfaceData).q_intData(hostname,first_seg_int_ext_name,first_seg_int_int_name,from,until,duration,$scope.grpState[0].state).then(function(val){$scope.data=val.data,$scope.labels=val.labels,$scope.series=val.series,$scope.colors=val.colors,$scope.options=val.options,$scope.datasetOverride=val.datasetOverride,$scope.int_data=val.int_data,$scope.int_name=val.int_name,$scope.complete_first_seg_count=val.complete_count},function(val){}),(new ReportInterfaceData).q_intData(hostname,second_seg_int_ext_name,second_seg_int_int_name,from,until,duration,$scope.grpState[0].state).then(function(val){$scope.second_seg_data=val.data,$scope.second_seg_labels=val.labels,$scope.second_seg_series=val.series,$scope.second_seg_colors=val.colors,$scope.second_seg_options=val.options,$scope.second_seg_datasetOverride=val.datasetOverride,$scope.second_seg_int_data=val.int_data,$scope.second_seg_int_name=val.int_name,$scope.complete_second_seg_count=val.complete_count},function(val){})}else{_.each($scope.segState,function(state,state_index){0===state_index&&(state.state=!0)});var first_seg_int_ext_name=val.int_ext_name[0],first_seg_int_int_name=val.int_int_name[0],firstSegIntGrpDataset=new ReportInterfaceData;firstSegIntGrpDataset.q_intData(hostname,first_seg_int_ext_name,first_seg_int_int_name,from,until,duration,$scope.grpState[0].state).then(function(val){$scope.data=val.data,$scope.labels=val.labels,$scope.series=val.series,$scope.colors=val.colors,$scope.options=val.options,$scope.datasetOverride=val.datasetOverride,$scope.int_data=val.int_data,$scope.int_name=val.int_name,$scope.complete_first_seg_count=val.complete_count},function(val){})}(new ReportUserData).q_userData(hostname,from,until,duration,$scope.grpState[1].state).then(function(val){$scope._users_tb_data=val.user._users_tb_data,$scope._users_data=val.user._users_data,$scope._users_flow_disc_data=val.user._users_flow_disc_data,$scope._users_label=val.user._users_label,$scope._users_series=val.user._users_series,$scope._users_flow_disc_series=val.user._users_flow_disc_series,$scope._users_option=val.user._users_option,$scope._users_flow_disc_option=val.user._users_flow_disc_option,$scope._users_datasetOverride=val.user._users_datasetOverride,$scope.colors=val.user.colors,$scope._users_app=val.user_app._users_app,$scope._users_app_data=val.user_app._users_app_data,$scope._users_app_label=val.user_app._users_app_label,$scope._users_app_series=val.user_app._users_app_series,$scope._users_app_option=val.user_app._users_app_option,$scope.complete_user_count=val.complete_count},function(val){}),$scope._user_group_size=0,(new ReportUserGroupData).q_userGroupData(hostname,from,until,duration,$scope.grpState[2].state).then(function(val){$scope._user_group_label=val.user_group._user_group_label,$scope._user_group_data=val.user_group._user_group_data,$scope._user_group_series=val.user_group._user_group_series,$scope._user_group_option=val.user_group._user_group_option,$scope._user_group_colors=val.user_group._user_group_colors,$scope._user_group_size=val.user_group._user_group_size,$scope._user_group_tb_data=val.user_group._user_group_tb_data,$scope._user_group_size=val.user_group._user_group_size,$scope._user_in_group_tb=val.user_in_group._user_in_group_tb,$scope._user_in_group_tr_data=val.user_in_group._user_in_group_tr_data,$scope._user_in_group_label=val.user_in_group._user_in_group_label,$scope._user_in_group_series=val.user_in_group._user_in_group_series,$scope._user_in_group_option=val.user_in_group._user_in_group_option,$scope.complete_usergroup_count=val.complete_count},function(val){})},function(val){}),$scope.export_print=function(){$window.print()};var size={};size.header_page={},size.first_page={},size.second_page={},size.third_page={},size.fourth_page={},size.fifth_page={},size.fifth_page_grp={},size.fifth_page_tb={},size.fifth_page_tb_group={},size.fifth_page_tb_set={},size.last_page={};var _from=new Date(from),_until=new Date(until);$scope.from=_from.toLocaleString(),$scope.until=_until.toLocaleString();var duration=$window.Sugar.Date.range(from,until).every("days").length;$scope.back=function(){$window.location.reload()},$scope.export_xls=function(){if($scope.grpState[0].state&&$scope.grpState[1].state){var data1=alasql('SELECT * FROM HTML("#table1",{headers:true})'),data2=alasql('SELECT * FROM HTML("#table2",{headers:true})'),data3=alasql('SELECT * FROM HTML("#table3",{headers:true})'),int_file='SELECT * INTO CSV("interface-'+$scope.from+"~"+$scope.until+'.csv",{headers:true, separator:","}) FROM ?';alasql(int_file,[data1]),alasql('SELECT * INTO CSV("user_traffic.csv",{headers:true, separator:","}) FROM ?',[data2]),alasql('SELECT * INTO CSV("user_app_traffic.csv",{headers:true, separator:","}) FROM ?',[data3]),notie.alert({type:"error",text:"csv파일이 생성되었습니다!"})}else if($scope.grpState[0].state){data1=alasql('SELECT * FROM HTML("#table1",{headers:true})');alasql('SELECT * INTO CSV("interface.csv",{headers:true, separator:","}) FROM ?',[data1]),notie.alert({type:"error",text:"csv파일이 생성되었습니다!"})}else if($scope.grpState[1].state){var data2=alasql('SELECT * FROM HTML("#table2",{headers:true})'),data3=alasql('SELECT * FROM HTML("#table3",{headers:true})');alasql('SELECT * INTO CSV("user_traffic.csv",{headers:true, separator:","}) FROM ?',[data2]),alasql('SELECT * INTO CSV("user_app_traffic.csv",{headers:true, separator:","}) FROM ?',[data3]),notie.alert({type:"error",text:"csv파일이 생성되었습니다!"})}else notie.alert({type:"error",text:"출력할 데이터가 존재하지 않습니다."})}}),reportApp.service("ReportAuth",function($base64){return function(start){var self=this;this.addId=function(id){return start+=id,self},this.addPasswd=function(pass){return start=start+":"+pass,self},this.getAuth=function(){return{Authorization:"Basic "+$base64.encode(start)}}}}),reportApp.service("ReportConfig",function($q){return function(){var result;this.getConfig=function(){return $.getJSON("./config/report-config.json",function(d){result=d.config}),result},this.q_configData=function(){var deferred=$q.defer();return $.getJSON("./config/report-config.json",function(d){deferred.resolve(d.config)}),deferred.promise}}}),reportApp.service("ReportFrom",function(){return function(start){var self=this;this.setFrom=function(_from){var from=new Date(_from),_from_yy=moment(from.toUTCString()).utc().format("YYYY"),_from_mm=moment(from.toUTCString()).utc().format("MM"),_from_dd=moment(from.toUTCString()).utc().format("DD"),_from_hh=moment(from.toUTCString()).utc().format("HH"),_from_min=moment(from.toUTCString()).utc().format("mm"),_from_sec=moment(from.toUTCString()).utc().format("ss");return start=start+_from_hh+":"+_from_min+":"+_from_sec+"_"+_from_yy+_from_mm+_from_dd,self},this.getFrom=function(){return start}}}),reportApp.service("ReportInterfaceData",function($window,$q,ReportData){return function(){function makeRcvData(_history_length_rcv_rate,_history_rcv,from_date,_from_date,duration){var label=[],data_rcv_rate=[],int_date=[],int_cmp_date=[],int_rcv_avg=[],int_rcv_max_data=[],int_rcv_duration_max_data=[],int_rcv_duration_max_date=[],rcv_tot=[],rcv_len=[];for(int_date.push(from_date.format("%F")),int_cmp_date.push(_from_date.format("%m-%d")),j=0;j<duration-1;j++)int_date.push(from_date.addDays(1).format("%F").raw),int_cmp_date.push(_from_date.addDays(1).format("%m-%d"));for(i=0;i<_history_length_rcv_rate;i++)if(i%20==0){var t=new Date(_history_rcv[i][0]);label.push(t.toLocaleString()),data_rcv_rate.push((.001*_history_rcv[i][1]).toFixed(3))}for(j=0;j<duration;j++)rcv_tot.push(0),rcv_len.push(0),int_rcv_duration_max_data.push([]),int_rcv_duration_max_date.push([]);for(j=0;j<duration;j++)for(var i=0;i<_history_length_rcv_rate;i++)int_cmp_date[j].raw===moment(_history_rcv[i][0]).format("MM-DD")?(rcv_tot[j]+=.001*_history_rcv[i][1],rcv_len[j]+=1,int_rcv_duration_max_data[j].push(.001*_history_rcv[i][1]),int_rcv_duration_max_date[j].push(_history_rcv[i][0])):(rcv_tot[j]+=0,rcv_len[j]+=1,int_rcv_duration_max_data[j].push(0),int_rcv_duration_max_date[j].push(NaN));for(j=0;j<duration;j++)int_rcv_avg.push(rcv_tot[j]/rcv_len[j]);for(var j=0;j<duration;j++)0===Math.max.apply(null,int_rcv_duration_max_data[j])?int_rcv_max_data.push({rcv_max_rate:0,rcv_max_date:NaN}):int_rcv_max_data.push({rcv_max_rate:Math.max.apply(null,int_rcv_duration_max_data[j]),rcv_max_date:int_rcv_duration_max_date[j][int_rcv_duration_max_data[j].indexOf(Math.max.apply(null,int_rcv_duration_max_data[j]))]});return{label:label,int_date:int_date,int_cmp_date:int_cmp_date,data_rcv_rate:data_rcv_rate,int_rcv_avg:int_rcv_avg,int_rcv_max_data:int_rcv_max_data}}function makeTrsData(_history_length_trs_rate,_history_trs,int_cmp_date,duration){for(var data_trs_rate=[],int_trs_avg=[],int_trs_max_data=[],int_trs_duration_max_data=[],int_trs_duration_max_date=[],trs_tot=[],trs_len=[],i=0;i<_history_length_trs_rate;i++)i%20==0&&data_trs_rate.push((.001*_history_trs[i][1]).toFixed(3));for(j=0;j<duration;j++)trs_tot.push(0),trs_len.push(0),int_trs_duration_max_data.push([]),int_trs_duration_max_date.push([]);for(j=0;j<duration;j++)for(i=0;i<_history_length_trs_rate;i++)int_cmp_date[j].raw===moment(_history_trs[i][0]).format("MM-DD")?(trs_tot[j]+=.001*_history_trs[i][1],trs_len[j]+=1,int_trs_duration_max_data[j].push(.001*_history_trs[i][1]),int_trs_duration_max_date[j].push(_history_trs[i][0])):(trs_tot[j]+=0,trs_len[j]+=1,int_trs_duration_max_data[j].push(0),int_trs_duration_max_date[j].push(NaN));for(j=0;j<duration;j++)int_trs_avg.push(trs_tot[j]/trs_len[j]);for(var j=0;j<duration;j++)int_trs_max_data.push({trs_max_rate:Math.max.apply(null,int_trs_duration_max_data[j]),trs_max_date:int_trs_duration_max_date[j][int_trs_duration_max_data[j].indexOf(Math.max.apply(null,int_trs_duration_max_data[j]))]});return{data_trs_rate:data_trs_rate,int_trs_avg:int_trs_avg,int_trs_max_data:int_trs_max_data}}function makeReportInterfaceData(int_date,data_rcv_rate,int_rcv_avg,int_rcv_max_data,data_trs_rate,int_trs_avg,int_trs_max_data){for(var int_data=[],k=0;k<int_date.length;k++)int_data.push({date:int_date[k],rcv_avg:isNaN(int_rcv_avg[k])?0:int_rcv_avg[k].toFixed(3),trs_avg:isNaN(int_trs_avg[k])?0:int_trs_avg[k].toFixed(3),rcv_max:isNaN(int_rcv_max_data[k].rcv_max_rate)?0:int_rcv_max_data[k].rcv_max_rate.toFixed(3),rcv_max_date:isNaN(int_rcv_max_data[k].rcv_max_date&&0!==int_rcv_max_data[k].rcv_max_rate)?"none":new Date(int_rcv_max_data[k].rcv_max_date).toLocaleString(),trs_max:isNaN(int_trs_max_data[k].trs_max_rate)?0:int_trs_max_data[k].trs_max_rate.toFixed(3),trs_max_date:isNaN(int_trs_max_data[k].trs_max_date)||0===int_trs_max_data[k].trs_max_rate?"none":new Date(int_trs_max_data[k].trs_max_date).toLocaleString()});var intGrpData=[data_rcv_rate,data_trs_rate],int_rcv_max=Math.max.apply(null,data_rcv_rate),int_trs_max=Math.max.apply(null,data_trs_rate),int_max=Math.max.apply(null,[int_rcv_max,int_trs_max]),option_max=Math.round(int_max);return{data:intGrpData,options:{scales:{yAxes:[{id:"y-axis-1",type:"linear",display:!0,position:"left",scaleLabel:{display:!0,fontSize:14,labelString:"수신(Mbit/s)",fontStyle:"bold"},ticks:{max:option_max,min:0,beginAtZero:!0,fontSize:12,fontStyle:"bold"}},{id:"y-axis-2",type:"linear",display:!0,position:"right",scaleLabel:{display:!0,fontSize:14,labelString:"송신(Mbit/s)",fontStyle:"bold"},ticks:{max:option_max,min:0,beginAtZero:!0,fontSize:12,fontStyle:"bold"}}],xAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"시간",fontStyle:"bold"}}]}},int_data:int_data}}this.q_intData=function(hostname,int_ext_name,int_int_name,from,until,duration,isset){var deferred=$q.defer(),from=from,duration=duration,from_date=new $window.Sugar.Date(from),_from_date=new $window.Sugar.Date(from),complete_count=0;return isset&&ReportData.getIntRcvData(hostname,int_ext_name).then(function(data){complete_count+=1;var _history_length_rcv_rate=data.data.collection[0]._history_length_receive_rate,_history_rcv=data.data.collection[0]._history_receive_rate,int_name=data.data.collection[0].name,r__rcvData=makeRcvData(_history_length_rcv_rate,_history_rcv,from_date,_from_date,duration),labels=r__rcvData.label,int_date=r__rcvData.int_date,int_cmp_date=r__rcvData.int_cmp_date,data_rcv_rate=r__rcvData.data_rcv_rate,int_rcv_avg=r__rcvData.int_rcv_avg,int_rcv_max_data=r__rcvData.int_rcv_max_data,series=["수신(단위:Mbit/s)","송신(단위:Mbit/s)"],colors=["#ff6384","#45b7cd","#ffe200"],datasetOverride=[{yAxisID:"y-axis-1"},{yAxisID:"y-axis-2"}];ReportData.getIntRcvData(hostname,int_int_name).then(function(data){complete_count+=1;var r__trsData=makeTrsData(data.data.collection[0]._history_length_receive_rate,data.data.collection[0]._history_receive_rate,int_cmp_date,duration),data_trs_rate=r__trsData.data_trs_rate,int_trs_avg=r__trsData.int_trs_avg,int_trs_max_data=r__trsData.int_trs_max_data,r__reportInterfaceData=makeReportInterfaceData(int_date,data_rcv_rate,int_rcv_avg,int_rcv_max_data,data_trs_rate,int_trs_avg,int_trs_max_data);deferred.resolve({data:r__reportInterfaceData.data,labels:labels,series:series,colors:colors,options:r__reportInterfaceData.options,datasetOverride:datasetOverride,int_data:r__reportInterfaceData.int_data,int_name:int_name,complete_count:complete_count})})}),deferred.promise}}}),reportApp.service("ReportIntName",function($window,$q,ReportData){return function(){this.q_intName=function(hostname){var deferred=$q.defer();return ReportData.getInterfaceName(hostname).then(function(data){for(var collection=data.data.collection,int_ext_name=[],int_int_name=[],i=0;i<collection.length;i++)int_ext_name.push(collection[i].name),int_int_name.push(collection[i].peer.link.name);deferred.resolve({int_ext_name:int_ext_name,int_int_name:int_int_name})}),deferred.promise}}}),reportApp.service("ReportMainMetaData",function($window,$q,ReportMain){return function(){this.q_metaLinkData=function(){var deferred=$q.defer();return ReportMain.getMetaLink().then(function(data){var metadata=data,intLink=metadata.data.collection[0].interfaces.link.href,hostname=metadata.data.collection[0].system_name;deferred.resolve({int_link:intLink,hostname:hostname})}),deferred.promise}}}),reportApp.service("ReportMetaData",function($window,$q,ReportData){return function(){this.q_metaLinkData=function(){var deferred=$q.defer();return ReportData.getMetaLink().then(function(data){var metadata=data,intLink=metadata.data.collection[0].interfaces.link.href,hostname=metadata.data.collection[0].system_name;deferred.resolve({int_link:intLink,hostname:hostname})}),deferred.promise}}}),reportApp.service("ReportQstring",function(){return function(start){var self=this;this.addSelect=function(attr){return start+=attr,self},this.addOperation=function(operation){return start+=operation,self},this.addOrder=function(order){return start+=order,self},this.addHistPoint=function(val){return start+=val,self},this.addLimit=function(limit){return start+=limit,self},this.addWith=function(_with){return start+=_with,self},this.addFrom=function(from){return start+=from,self},this.addUntil=function(until){return start+=until,self},this.getQstring=function(){return start}}}),reportApp.service("ReportUntil",function(){return function(start){var self=this;this.setUntil=function(_until){var until=new Date(_until),_until_yy=moment(until.toUTCString()).utc().format("YYYY"),_until_mm=moment(until.toUTCString()).utc().format("MM"),_until_dd=moment(until.toUTCString()).utc().format("DD"),_until_hh=moment(until.toUTCString()).utc().format("HH"),_until_min=moment(until.toUTCString()).utc().format("mm"),_until_sec=moment(until.toUTCString()).utc().format("ss");return start=start+_until_hh+":"+_until_min+":"+_until_sec+"_"+_until_yy+_until_mm+_until_dd,self},this.getUntil=function(){return start}}}),reportApp.service("ReportUrl",function(){return function(start){var self=this;this.addDefault=function(ip,port,path){return start=start+ip+port+path,self},this.addSection=function(section){return start+=section,self},this.addQstring=function(qstring){return start+=qstring,self},this.getUrls=function(){return start}}}),reportApp.service("ReportUserData",function($window,$q,ReportData,UserAppData,_){return function(){this.q_userData=function(hostname,from,until,duration,isset){var deferred=$q.defer(),complete_count=0;return isset&&ReportData.getUserActiveFlows(hostname).then(function(data){complete_count+=1;var _history_users_active_flows_data=data.data.collection,users_act_flow_max_data=(data.data.collection[0]._history_active_flows,data.data.collection[0]._history_length_active_flows,[]);_.each(_history_users_active_flows_data,function(collection){users_act_flow_max_data.push(_.max(collection._history_active_flows,function(history_active_flows){return history_active_flows[1]}))}),_.each(users_act_flow_max_data,function(elem,index,data){var t=new Date(elem[0]);elem.push(t.toLocaleString())}),ReportData.getUserData(hostname).then(function(data){complete_count+=1;for(var _users_label=[],_users_from=[],_users_until=[],_users_series=["다운로드 사용량(Mbit/s)","업로드 사용량(Mbit/s)"],_users_flow_disc_series=["플로우 사용량(/s)","제어량(/s)"],_users_total=[],_users_download=[],_users_upload=[],_users_active_flows=[],_users_packet_disc_rate=[],_users_tb_data=[],_users_data=[],_users_flow_disc_data=[],_users_app=[],_users_app_top1=[],_users_app_top2=[],_users_app_top3=[],_users_app_data=[],_users_appName_top1=[],_users_appName_top2=[],_users_appName_top3=[],_users_app_label=[],_users_app_series=[],_users_app_option=[],colors=["#ff6384","#45b7cd","#ffe200"],_users=data.data.collection,i=0;i<_users.length;i++){_users_label.push(_users[i].name);var user_from=new Date(_users[i].from);user_from.setHours(user_from.getHours()+9),_users_from.push(user_from.toLocaleString());var user_until=new Date(_users[i].until);_users_until.push(user_until.setHours(user_until.getHours()+9)),_users_total.push((.001*_users[i].total_rate).toFixed(3)),_users_download.push((.001*_users[i].dest_rate).toFixed(3)),_users_upload.push((.001*_users[i].source_rate).toFixed(3)),_users_active_flows.push(_users[i].active_flows),_users_packet_disc_rate.push(_users[i].packet_discard_rate),_users_packet_disc_rate.push(_users[i].packets_discarded),_users_tb_data.push({name:_users[i].name,from:_.has(_users[i],"from")?user_from.toLocaleString():"None",until:_.has(_users[i],"until")?user_until.toLocaleString():"None",total:(.001*_users[i].total_rate).toFixed(3),down:(.001*_users[i].dest_rate).toFixed(3),up:(.001*_users[i].source_rate).toFixed(3),flows:_users[i].active_flows,disc_rate:_users[i].packet_discard_rate,pack_disc:_users[i].packets_discarded})}_.each(_users_tb_data,function(e,i){_.each(users_act_flow_max_data,function(elem,index){index===i&&_.extend(e,{max_flows:elem[1]},{max_flows_time:elem[2]})})}),_users_data.push(_users_download),_users_data.push(_users_upload),_users_flow_disc_data.push(_users_active_flows),_users_flow_disc_data.push(_users_packet_disc_rate);for(var _users_option={scales:{yAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"내부사용자",fontStyle:"bold"}}],xAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"사용량(Mbit/s)",fontStyle:"bold"}}]}},_users_flow_disc_option={scales:{yAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"내부사용자",fontStyle:"bold"}}],xAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"사용/제어량(/s)",fontStyle:"bold"}}]}},_users_datasetOverride=[{xAxisID:"x-axis-1"},{xAxisID:"x-axis-2"}],i=0;i<_users_label.length;i++)complete_count+=1,UserAppData.getUserAppData(hostname,_users_label[i]).then(function(data){if(_.has(data.data.collection[0],"from")&&_.has(data.data.collection[0],"until"))(top1_from=new Date(data.data.collection[0].from)).setHours(top1_from.getHours()+9),(top1_until=new Date(data.data.collection[0].until)).setHours(top1_until.getHours()+9);else var top1_from="None",top1_until="None";if(_.has(data.data.collection[1],"from")&&_.has(data.data.collection[1],"until"))(top2_from=new Date(data.data.collection[1].from)).setHours(top2_from.getHours()+9),(top2_until=new Date(data.data.collection[1].until)).setHours(top2_until.getHours()+9);else var top2_from="None",top2_until="None";if(_.has(data.data.collection[2],"from")&&_.has(data.data.collection[2],"until"))(top3_from=new Date(data.data.collection[2].from)).setHours(top3_from.getHours()+9),(top3_until=new Date(data.data.collection[2].until)).setHours(top3_until.getHours()+9);else var top3_from="None",top3_until="None";_users_app.push({user_name:data.data.collection[0].link.href.split("/")[6],top1_app_name:_.has(data.data.collection[0],"name")?data.data.collection[0].name:"None",top1_app_total:_.has(data.data.collection[0],"total_rate")?(.001*data.data.collection[0].total_rate).toFixed(3):0,top1_app_from:top1_from.toLocaleString(),top1_app_until:top1_until.toLocaleString(),top2_app_name:_.has(data.data.collection[1],"name")?data.data.collection[1].name:"None",top2_app_total:_.has(data.data.collection[1],"total_rate")?(.001*data.data.collection[1].total_rate).toFixed(3):0,top2_app_from:top2_from.toLocaleString(),top2_app_until:top2_until.toLocaleString(),top3_app_name:_.has(data.data.collection[2],"name")?data.data.collection[2].name:"None",top3_app_total:_.has(data.data.collection[2],"total_rate")?(.001*data.data.collection[2].total_rate).toFixed(3):0,top3_app_from:top3_from.toLocaleString(),top3_app_until:top3_until.toLocaleString()}),_users_app.sort(function(a,b){return b.top1_app_total-a.top1_app_total}),_.has(data.data.collection[0],"total_rate")?_users_app_top1.push((.001*data.data.collection[0].total_rate).toFixed(3)):_users_app_top1.push(0),_.has(data.data.collection[1],"total_rate")?_users_app_top2.push((.001*data.data.collection[1].total_rate).toFixed(3)):_users_app_top2.push(0),_.has(data.data.collection[2],"total_rate")?_users_app_top3.push((.001*data.data.collection[2].total_rate).toFixed(3)):_users_app_top3.push(0),_.has(data.data.collection[0],"name")?_users_appName_top1.push((.001*data.data.collection[0].name).toFixed(3)):_users_appName_top1.push(0),_.has(data.data.collection[1],"name")?_users_appName_top2.push((.001*data.data.collection[1].name).toFixed(3)):_users_appName_top2.push(0),_.has(data.data.collection[2],"name")?_users_appName_top3.push((.001*data.data.collection[2].name).toFixed(3)):_users_appName_top3.push(0),_.has(data.data.collection[0],"name")&&_.has(data.data.collection[1],"name")&&_.has(data.data.collection[2],"name")?_users_app_label.push(data.data.collection[0].link.href.split("/")[6]+"(1."+data.data.collection[0].name+",2."+data.data.collection[1].name+",3."+data.data.collection[2].name+")"):_.has(data.data.collection[0],"name")&&_.has(data.data.collection[1],"name")?_users_app_label.push(data.data.collection[0].link.href.split("/")[6]+"(1."+data.data.collection[0].name+",2."+data.data.collection[1].name+")"):_.has(data.data.collection[0],"name")&&_.has(data.data.collection[2],"name")?_users_app_label.push(data.data.collection[0].link.href.split("/")[6]+"(1."+data.data.collection[0].name+",3."+data.data.collection[2].name+")"):_.has(data.data.collection[1],"name")&&_.has(data.data.collection[2],"name")?_users_app_label.push(data.data.collection[1].link.href.split("/")[6]+"(2."+data.data.collection[1].name+",3."+data.data.collection[2].name+")"):_.has(data.data.collection[0],"name")?_users_app_label.push(data.data.collection[0].link.href.split("/")[6]+"(1."+data.data.collection[0].name+")"):_.has(data.data.collection[1],"name")?_users_app_label.push(data.data.collection[1].link.href.split("/")[6]+"(2."+data.data.collection[1].name+")"):_users_app_label.push(data.data.collection[2].link.href.split("/")[6]+"(3."+data.data.collection[2].name+")")});var _users_app_data=[_users_app_top1,_users_app_top2,_users_app_top3],_users_app_series=["TOP APP 1","TOP APP 2","TOP APP 3"],_users_app_option={scales:{xAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"APP 사용량(Mbit/s)",fontStyle:"bold"}}],yAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"사용자 어플리케이션(Top1,Top2,Top3)",fontStyle:"bold"}}]}};deferred.resolve({user:{_users_tb_data:_users_tb_data,_users_data:_users_data,_users_flow_disc_data:_users_flow_disc_data,_users_label:_users_label,_users_series:_users_series,_users_flow_disc_series:_users_flow_disc_series,_users_option:_users_option,_users_flow_disc_option:_users_flow_disc_option,_users_datasetOverride:_users_datasetOverride,colors:colors},user_app:{_users_app:_users_app,_users_app_data:_users_app_data,_users_app_label:_users_app_label,_users_app_series:_users_app_series,_users_app_option:_users_app_option,colors:colors},complete_count:complete_count})})}),deferred.promise},this.q_userFlowData=function(hostname,from,until,duration,isset){var deferred=$q.defer();return isset&&ReportData.getUserActiveFlows(hostname).then(function(data){deferred.resolve("resolve!")}),deferred.promise}}}),reportApp.service("ReportUserGroupData",function($window,$q,_,ReportData,UserInGroupData,SharedData){return function(){this.q_userGroupData=function(hostname,from,until,duration,isset){var deferred=$q.defer(),complete_count=0;return isset&&ReportData.getUserGroupSize(hostname).then(function(size){complete_count+=1,ReportData.getUserGroupActiveFlows(hostname,size.group_size).then(function(group_flow_data){complete_count+=1;var _history_user_group_active_flows_data=group_flow_data.data.collection,user_group_act_flow_max_data=[];_.each(_history_user_group_active_flows_data,function(collection){user_group_act_flow_max_data.push(_.max(collection._history_active_flows,function(history_active_flows){return history_active_flows[1]}))}),_.each(user_group_act_flow_max_data,function(elem,index,data){var t=new Date(elem[0]);elem.push(t.toLocaleString())}),ReportData.getUserGroupData(hostname,size.group_size).then(function(data){complete_count+=1;var _user_group_label=[],_user_group_from=[],_user_group_until=[],_user_group_series=["다운로드 사용량(Mbit/s)","업로드 사용량(Mbit/s)"],_user_group_total=[],_user_group_download=[],_user_group_upload=[],_user_group_active_flows=[],_user_group_packet_disc=[],_user_group_packet_disc_rate=[],_user_group_tb_data=[],_user_group_data=[],_user_group_colors=["#ff6384","#45b7cd","#ffe200"],_user_groups=data.data.collection,_user_group_size=data.data.size;_(_user_groups).each(function(elem,index){_user_group_label.push(elem.name);var user_group_from=new Date(elem.from);user_group_from.setHours(user_group_from.getHours()+9),_user_group_from.push(user_group_from.toLocaleString());var user_group_until=new Date(elem.until);user_group_until.setHours(user_group_until.getHours()+9),_user_group_until.push(user_group_until.toLocaleString()),_user_group_total.push((.001*elem.total_rate).toFixed(3)),_user_group_download.push((.001*elem.dest_rate).toFixed(3)),_user_group_upload.push((.001*elem.source_rate).toFixed(3)),_user_group_active_flows.push(elem.active_flows),_user_group_packet_disc_rate.push(elem.packet_discard_rate),_user_group_packet_disc.push(elem.packets_discarded),_user_group_tb_data.push({name:elem.name,from:user_group_from.toLocaleString(),until:user_group_until.toLocaleString(),total:(.001*elem.total_rate).toFixed(3),down:(.001*elem.dest_rate).toFixed(3),up:(.001*elem.source_rate).toFixed(3),flows:elem.active_flows,disc_rate:elem.packet_discard_rate,pack_disc:elem.packets_discarded})}),_user_group_data.push(_user_group_download),_user_group_data.push(_user_group_upload),_.each(_user_group_tb_data,function(e,i){_.each(user_group_act_flow_max_data,function(elem,index){index===i&&_.extend(e,{max_flows:elem[1]},{max_flows_time:elem[2]})})});var _user_group_option={scales:{yAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"사용자 그룹",fontStyle:"bold"}}],xAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"트래픽 사용량(Mbit/s)",fontStyle:"bold"}}]}},_user_in_group_tb=[],_group_name_tb=[],_user_in_group_tr_top1=[],_user_in_group_tr_top2=[],_user_in_group_tr_top3=[],_user_in_group_tr_top4=[],_user_in_group_tr_top5=[],_user_in_group_label=[];_(_user_group_label).each(function(elem,index){complete_count+=1,_group_name_tb.push(elem),UserInGroupData.getUserInGroupData(hostname,elem).then(function(data){var top1_user_from,top2_user_from,top3_user_from,top4_user_from,top5_user_from,top1_user_until,top2_user_until,top3_user_until,top4_user_until,top5_user_until,top1_user_name,top2_user_name,top3_user_name,top4_user_name,top5_user_name,top1_user_total,top2_user_total,top3_user_total,top4_user_total,top5_user_total,top1_user_down,top2_user_down,top3_user_down,top4_user_down,top5_user_down,top1_user_up,top2_user_up,top3_user_up,top4_user_up,top5_user_up,top1_user_active_flow,top2_user_active_flow,top3_user_active_flow,top4_user_active_flow,top5_user_active_flow,top1_user_packet_disc_rate,top2_user_packet_disc_rate,top3_user_packet_disc_rate,top4_user_packet_disc_rate,top5_user_packet_disc_rate,top1_user_packet_disc,top2_user_packet_disc,top3_user_packet_disc,top4_user_packet_disc,top5_user_packet_disc,top1_user_max_flow_data,top2_user_max_flow_data,top3_user_max_flow_data,top4_user_max_flow_data,top5_user_max_flow_data,top1_user_max_flow,top2_user_max_flow,top3_user_max_flow,top4_user_max_flow,top5_user_max_flow,top1_user_max_flow_time,top2_user_max_flow_time,top3_user_max_flow_time,top4_user_max_flow_time,top5_user_max_flow_time,top1_user_app1_name,top1_user_app2_name,top1_user_app3_name,top1_user_app1_total,top1_user_app2_total,top1_user_app3_total,top2_user_app1_name,top2_user_app2_name,top2_user_app3_name,top2_user_app1_total,top2_user_app2_total,top2_user_app3_total,top3_user_app1_name,top3_user_app2_name,top3_user_app3_name,top3_user_app1_total,top3_user_app2_total,top3_user_app3_total,top4_user_app1_name,top4_user_app2_name,top4_user_app3_name,top4_user_app1_total,top4_user_app2_total,top4_user_app3_total,top5_user_app1_name,top5_user_app2_name,top5_user_app3_name,top5_user_app1_total,top5_user_app2_total,top5_user_app3_total,top_user_data=[],resolve_cnt=0;$q(function(resolve,reject){0!==data.data.collection.length?_(data.data.collection).each(function(e,i){complete_count+=2,0===i&&(complete_count+=2,UserInGroupData.getUserInGroupActiveFlows(hostname,e.name).then(function(user_in_group_flow_data){UserInGroupData.getUserInGroupAppData(hostname,e.name).then(function(user_in_group_app_data){try{(top1_user_from=new Date(e.from)).setHours(top1_user_from.getHours()+9),top1_user_from=top1_user_from.toLocaleString(),(top1_user_until=new Date(e.until)).setHours(top1_user_until.getHours()+9),top1_user_until=top1_user_until.toLocaleString()}catch(exception){top1_user_from="None",top1_user_until="None"}try{top1_user_name=e.name}catch(exception){top1_user_name="None"}try{top1_user_total=(.001*e.total_rate).toFixed(3)}catch(exception){top1_user_total=0}try{top1_user_down=(.001*e.dest_rate).toFixed(3)}catch(exception){top1_user_down=0}try{top1_user_up=(.001*e.source_rate).toFixed(3)}catch(exception){top1_user_up=0}try{top1_user_active_flow=e.active_flows}catch(exception){top1_user_active_flow=0}try{top1_user_packet_disc_rate=e.packet_discard_rate}catch(exception){top1_user_packet_disc_rate=0}try{top1_user_packet_disc=e.packets_discarded}catch(exception){top1_user_packet_disc=0}try{var _history_user_in_group_active_flows_data=user_in_group_flow_data.data.collection[0]._history_active_flows;top1_user_max_flow_data=_.max(_history_user_in_group_active_flows_data,function(history_user_in_grp_active_flows){return history_user_in_grp_active_flows[1]}),top1_user_max_flow=top1_user_max_flow_data[1],top1_user_max_flow_time=new Date(top1_user_max_flow_data[0]).toLocaleString()}catch(exception){top1_user_max_flow=0,top1_user_max_flow_time="none"}try{(top1_user_app1_from=new Date(user_in_group_app_data.data.collection[0].from)).setHours(top1_user_app1_from.getHours()+9),(top1_user_app1_until=new Date(user_in_group_app_data.data.collection[0].until)).setHours(top1_user_app1_until.getHours()+9)}catch(exception){var top1_user_app1_from="None",top1_user_app1_until="None"}try{(top1_user_app2_from=new Date(user_in_group_app_data.data.collection[1].from)).setHours(top1_user_app2_from.getHours()+9),(top1_user_app2_until=new Date(user_in_group_app_data.data.collection[1].until)).setHours(top1_user_app2_until.getHours()+9)}catch(exception){var top1_user_app2_from="None",top1_user_app2_until="None"}try{(top1_user_app3_from=new Date(user_in_group_app_data.data.collection[2].from)).setHours(top1_user_app3_from.getHours()+9),(top1_user_app3_until=new Date(user_in_group_app_data.data.collection[2].until)).setHours(top1_user_app3_until.getHours()+9)}catch(exception){var top1_user_app3_from="None",top1_user_app3_until="None"}try{top1_user_app1_name=user_in_group_app_data.data.collection[0].name}catch(exception){top1_user_app1_name="None"}try{top1_user_app1_total=(.001*user_in_group_app_data.data.collection[0].total_rate).toFixed(3)}catch(exception){top1_user_app1_total=0}try{top1_user_app2_name=user_in_group_app_data.data.collection[1].name}catch(exception){top1_user_app2_name="None"}try{top1_user_app2_total=(.001*user_in_group_app_data.data.collection[1].total_rate).toFixed(3)}catch(exception){top1_user_app2_total=0}try{top1_user_app3_name=user_in_group_app_data.data.collection[2].name}catch(exception){top1_user_app3_name="None"}try{top1_user_app3_total=(.001*user_in_group_app_data.data.collection[2].total_rate).toFixed(3)}catch(exception){top1_user_app3_total=0}top_user_data.push({top_user_name:0!==data.data.collection.length?top1_user_name:"None",top_user_total:0!==data.data.collection.length?top1_user_total:0,top_user_down:0!==data.data.collection.length?top1_user_down:0,top_user_up:0!==data.data.collection.length?top1_user_up:0,top_user_active_flow:0!==data.data.collection.length?top1_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top1_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top1_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top1_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top1_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top1_user_from:"None",top_user_until:0!==data.data.collection.length?top1_user_until:"None",top_user_app1_name:top1_user_app1_name,top_user_app1_total:top1_user_app1_total,top_user_app1_from:top1_user_app1_from.toLocaleString(),top_user_app1_until:top1_user_app1_until.toLocaleString(),top_user_app2_name:top1_user_app2_name,top_user_app2_total:top1_user_app2_total,top_user_app2_from:top1_user_app2_from.toLocaleString(),top_user_app2_until:top1_user_app2_until.toLocaleString(),top_user_app3_name:top1_user_app3_name,top_user_app3_total:top1_user_app3_total,top_user_app3_from:top1_user_app3_from.toLocaleString(),top_user_app3_until:top1_user_app3_until.toLocaleString()}),resolve("sucess make table data!"),resolve_cnt+=1})})),1===i&&(complete_count+=2,UserInGroupData.getUserInGroupActiveFlows(hostname,e.name).then(function(user_in_group_flow_data){UserInGroupData.getUserInGroupAppData(hostname,e.name).then(function(user_in_group_app_data){try{(top2_user_from=new Date(e.from)).setHours(top2_user_from.getHours()+9),top2_user_from=top2_user_from.toLocaleString(),(top2_user_until=new Date(e.until)).setHours(top2_user_until.getHours()+9),top2_user_until=top2_user_until.toLocaleString()}catch(exception){top2_user_from="None",top2_user_until="None"}try{top2_user_name=e.name}catch(exception){top2_user_name="None"}try{top2_user_total=(.001*e.total_rate).toFixed(3)}catch(exception){top2_user_total=0}try{top2_user_down=(.001*e.dest_rate).toFixed(3)}catch(exception){top2_user_total=0}try{top2_user_up=(.001*e.source_rate).toFixed(3)}catch(exception){top2_user_total=0}try{top2_user_active_flow=e.active_flows}catch(exception){top2_user_total=0}try{top2_user_packet_disc_rate=e.packet_discard_rate}catch(exception){top2_user_total=0}try{top2_user_packet_disc=e.packets_discarded}catch(exception){top2_user_packet_disc=0}try{var _history_user_in_group_active_flows_data=user_in_group_flow_data.data.collection[0]._history_active_flows;top2_user_max_flow_data=_.max(_history_user_in_group_active_flows_data,function(history_user_in_grp_active_flows){return history_user_in_grp_active_flows[1]}),top2_user_max_flow=top2_user_max_flow_data[1],top2_user_max_flow_time=new Date(top2_user_max_flow_data[0]).toLocaleString()}catch(exception){top2_user_max_flow=0,top2_user_max_flow_time="none"}try{(top2_user_app1_from=new Date(user_in_group_app_data.data.collection[0].from)).setHours(top2_user_app1_from.getHours()+9),(top2_user_app1_until=new Date(user_in_group_app_data.data.collection[0].until)).setHours(top2_user_app1_until.getHours()+9)}catch(exception){var top2_user_app1_from="None",top2_user_app1_until="None"}try{(top2_user_app2_from=new Date(user_in_group_app_data.data.collection[1].from)).setHours(top2_user_app2_from.getHours()+9),(top2_user_app2_until=new Date(user_in_group_app_data.data.collection[1].until)).setHours(top2_user_app2_until.getHours()+9)}catch(exception){var top2_user_app2_from="None",top2_user_app2_until="None"}try{(top2_user_app3_from=new Date(user_in_group_app_data.data.collection[2].from)).setHours(top2_user_app3_from.getHours()+9),(top2_user_app3_until=new Date(user_in_group_app_data.data.collection[2].until)).setHours(top2_user_app3_until.getHours()+9)}catch(exception){var top2_user_app3_from="None",top2_user_app3_until="None"}try{top2_user_app1_name=user_in_group_app_data.data.collection[0].name}catch(exception){top2_user_app1_name="None"}try{top2_user_app1_total=(.001*user_in_group_app_data.data.collection[0].total_rate).toFixed(3)}catch(exception){top2_user_app1_total=0}try{top2_user_app2_name=user_in_group_app_data.data.collection[1].name}catch(exception){top2_user_app2_name="None"}try{top2_user_app2_total=(.001*user_in_group_app_data.data.collection[1].total_rate).toFixed(3)}catch(exception){top2_user_app2_total=0}try{top2_user_app3_name=user_in_group_app_data.data.collection[2].name}catch(exception){top2_user_app3_name="None"}try{top2_user_app3_total=(.001*user_in_group_app_data.data.collection[2].total_rate).toFixed(3)}catch(exception){top2_user_app3_total=0}top_user_data.push({top_user_name:0!==data.data.collection.length?top2_user_name:"None",top_user_total:0!==data.data.collection.length?top2_user_total:0,top_user_down:0!==data.data.collection.length?top2_user_down:0,top_user_up:0!==data.data.collection.length?top2_user_up:0,top_user_active_flow:0!==data.data.collection.length?top2_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top2_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top2_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top2_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top2_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top2_user_from:"None",top_user_until:0!==data.data.collection.length?top2_user_until:"None",top_user_app1_name:top2_user_app1_name,top_user_app1_total:top2_user_app1_total,top_user_app1_from:top2_user_app1_from.toLocaleString(),top_user_app1_until:top2_user_app1_until.toLocaleString(),top_user_app2_name:top2_user_app2_name,top_user_app2_total:top2_user_app2_total,top_user_app2_from:top2_user_app2_from.toLocaleString(),top_user_app2_until:top2_user_app2_until.toLocaleString(),top_user_app3_name:top2_user_app3_name,top_user_app3_total:top2_user_app3_total,top_user_app3_from:top2_user_app3_from.toLocaleString(),top_user_app3_until:top2_user_app3_until.toLocaleString()}),resolve_cnt+=1})})),2===i&&(complete_count+=2,UserInGroupData.getUserInGroupActiveFlows(hostname,e.name).then(function(user_in_group_flow_data){UserInGroupData.getUserInGroupAppData(hostname,e.name).then(function(user_in_group_app_data){try{(top3_user_from=new Date(e.from)).setHours(top3_user_from.getHours()+9),top3_user_from=top3_user_from.toLocaleString(),(top3_user_until=new Date(e.until)).setHours(top3_user_until.getHours()+9),top3_user_until=top3_user_until.toLocaleString()}catch(exception){top3_user_from="None",top3_user_until="None"}try{top3_user_name=e.name}catch(exception){top3_user_name="None"}try{top3_user_total=(.001*e.total_rate).toFixed(3)}catch(exception){top3_user_total=0}try{top3_user_down=(.001*e.dest_rate).toFixed(3)}catch(exception){top3_user_total=0}try{top3_user_up=(.001*e.source_rate).toFixed(3)}catch(exception){top3_user_total=0}try{top3_user_active_flow=e.active_flows}catch(exception){top3_user_total=0}try{top3_user_packet_disc_rate=e.packet_discard_rate}catch(exception){top3_user_total=0}try{top3_user_packet_disc=e.packets_discarded}catch(exception){top3_user_packet_disc=0}try{var _history_user_in_group_active_flows_data=user_in_group_flow_data.data.collection[0]._history_active_flows;top3_user_max_flow_data=_.max(_history_user_in_group_active_flows_data,function(history_user_in_grp_active_flows){return history_user_in_grp_active_flows[1]}),top3_user_max_flow=top3_user_max_flow_data[1],top3_user_max_flow_time=new Date(top3_user_max_flow_data[0]).toLocaleString()}catch(exception){top3_user_max_flow=0,top3_user_max_flow_time="none"}try{(top3_user_app1_from=new Date(user_in_group_app_data.data.collection[0].from)).setHours(top3_user_app1_from.getHours()+9),(top3_user_app1_until=new Date(user_in_group_app_data.data.collection[0].until)).setHours(top3_user_app1_until.getHours()+9)}catch(exception){var top3_user_app1_from="None",top3_user_app1_until="None"}try{(top3_user_app2_from=new Date(user_in_group_app_data.data.collection[1].from)).setHours(top3_user_app2_from.getHours()+9),(top3_user_app2_until=new Date(user_in_group_app_data.data.collection[1].until)).setHours(top3_user_app2_until.getHours()+9)}catch(exception){var top3_user_app2_from="None",top3_user_app2_until="None"}try{(top3_user_app3_from=new Date(user_in_group_app_data.data.collection[2].from)).setHours(top3_user_app3_from.getHours()+9),(top3_user_app3_until=new Date(user_in_group_app_data.data.collection[2].until)).setHours(top3_user_app3_until.getHours()+9)}catch(exception){var top3_user_app3_from="None",top3_user_app3_until="None"}try{top3_user_app1_name=user_in_group_app_data.data.collection[0].name}catch(exception){top3_user_app1_name="None"}try{top3_user_app1_total=(.001*user_in_group_app_data.data.collection[0].total_rate).toFixed(3)}catch(exception){top3_user_app1_total=0}try{top3_user_app2_name=user_in_group_app_data.data.collection[1].name}catch(exception){top3_user_app2_name="None"}try{top3_user_app2_total=(.001*user_in_group_app_data.data.collection[1].total_rate).toFixed(3)}catch(exception){top3_user_app2_total=0}try{top3_user_app3_name=user_in_group_app_data.data.collection[2].name}catch(exception){top3_user_app3_name="None"}try{top3_user_app3_total=(.001*user_in_group_app_data.data.collection[2].total_rate).toFixed(3)}catch(exception){top3_user_app3_total=0}top_user_data.push({top_user_name:0!==data.data.collection.length?top3_user_name:"None",top_user_total:0!==data.data.collection.length?top3_user_total:0,top_user_down:0!==data.data.collection.length?top3_user_down:0,top_user_up:0!==data.data.collection.length?top3_user_up:0,top_user_active_flow:0!==data.data.collection.length?top3_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top3_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top3_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top3_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top3_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top3_user_from:"None",top_user_until:0!==data.data.collection.length?top3_user_until:"None",top_user_app1_name:top3_user_app1_name,top_user_app1_total:top3_user_app1_total,top_user_app1_from:top3_user_app1_from.toLocaleString(),top_user_app1_until:top3_user_app1_until.toLocaleString(),top_user_app2_name:top3_user_app2_name,top_user_app2_total:top3_user_app2_total,top_user_app2_from:top3_user_app2_from.toLocaleString(),top_user_app2_until:top3_user_app2_until.toLocaleString(),top_user_app3_name:top3_user_app3_name,top_user_app3_total:top3_user_app3_total,top_user_app3_from:top3_user_app3_from.toLocaleString(),top_user_app3_until:top3_user_app3_until.toLocaleString()}),resolve_cnt+=1})})),3===i&&(complete_count+=2,UserInGroupData.getUserInGroupActiveFlows(hostname,e.name).then(function(user_in_group_flow_data){UserInGroupData.getUserInGroupAppData(hostname,e.name).then(function(user_in_group_app_data){try{(top4_user_from=new Date(e.from)).setHours(top4_user_from.getHours()+9),top4_user_from=top4_user_from.toLocaleString(),(top4_user_until=new Date(e.until)).setHours(top4_user_until.getHours()+9),top4_user_until=top4_user_until.toLocaleString()}catch(exception){top4_user_from="None",top4_user_until="None"}try{top4_user_name=e.name}catch(exception){top4_user_name="None"}try{top4_user_total=(.001*e.total_rate).toFixed(3)}catch(exception){top4_user_total=0}try{top4_user_down=(.001*e.dest_rate).toFixed(3)}catch(exception){top4_user_down=0}try{top4_user_up=(.001*e.source_rate).toFixed(3)}catch(exception){top4_user_up=0}try{top4_user_active_flow=e.active_flows}catch(exception){top4_user_active_flow=0}try{top4_user_packet_disc_rate=e.packet_discard_rate}catch(exception){top4_user_packet_disc_rate=0}try{top4_user_packet_disc=e.packets_discarded}catch(exception){top4_user_packet_disc=0}try{var _history_user_in_group_active_flows_data=user_in_group_flow_data.data.collection[0]._history_active_flows;top4_user_max_flow_data=_.max(_history_user_in_group_active_flows_data,function(history_user_in_grp_active_flows){return history_user_in_grp_active_flows[1]}),top4_user_max_flow=top4_user_max_flow_data[1],top4_user_max_flow_time=new Date(top4_user_max_flow_data[0]).toLocaleString()}catch(exception){top4_user_max_flow=0,top4_user_max_flow_time="none"}try{(top4_user_app1_from=new Date(user_in_group_app_data.data.collection[0].from)).setHours(top4_user_app1_from.getHours()+9),(top4_user_app1_until=new Date(user_in_group_app_data.data.collection[0].until)).setHours(top4_user_app1_until.getHours()+9)}catch(exception){var top4_user_app1_from="None",top4_user_app1_until="None"}try{(top4_user_app2_from=new Date(user_in_group_app_data.data.collection[1].from)).setHours(top4_user_app2_from.getHours()+9),(top4_user_app2_until=new Date(user_in_group_app_data.data.collection[1].until)).setHours(top4_user_app2_until.getHours()+9)}catch(exception){var top4_user_app2_from="None",top4_user_app2_until="None"}try{(top4_user_app3_from=new Date(user_in_group_app_data.data.collection[2].from)).setHours(top4_user_app3_from.getHours()+9),(top4_user_app3_until=new Date(user_in_group_app_data.data.collection[2].until)).setHours(top4_user_app3_until.getHours()+9)}catch(exception){var top4_user_app3_from="None",top4_user_app3_until="None"}try{top4_user_app1_name=user_in_group_app_data.data.collection[0].name}catch(exception){top4_user_app1_name="None"}try{top4_user_app1_total=(.001*user_in_group_app_data.data.collection[0].total_rate).toFixed(3)}catch(exception){top4_user_app1_total=0}try{top4_user_app2_name=user_in_group_app_data.data.collection[1].name}catch(exception){top4_user_app2_name="None"}try{top4_user_app2_total=(.001*user_in_group_app_data.data.collection[1].total_rate).toFixed(3)}catch(exception){top4_user_app2_total=0}try{top4_user_app3_name=user_in_group_app_data.data.collection[2].name}catch(exception){top4_user_app3_name="None"}try{top4_user_app3_total=(.001*user_in_group_app_data.data.collection[2].total_rate).toFixed(3)}catch(exception){top4_user_app3_total=0}top_user_data.push({top_user_name:0!==data.data.collection.length?top4_user_name:"None",top_user_total:0!==data.data.collection.length?top4_user_total:0,top_user_down:0!==data.data.collection.length?top4_user_down:0,top_user_up:0!==data.data.collection.length?top4_user_up:0,top_user_active_flow:0!==data.data.collection.length?top4_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top4_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top4_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top4_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top4_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top4_user_from:"None",top_user_until:0!==data.data.collection.length?top4_user_until:"None",top_user_app1_name:top4_user_app1_name,top_user_app1_total:top4_user_app1_total,top_user_app1_from:top4_user_app1_from.toLocaleString(),top_user_app1_until:top4_user_app1_until.toLocaleString(),top_user_app2_name:top4_user_app2_name,top_user_app2_total:top4_user_app2_total,top_user_app2_from:top4_user_app2_from.toLocaleString(),top_user_app2_until:top4_user_app2_until.toLocaleString(),top_user_app3_name:top4_user_app3_name,top_user_app3_total:top4_user_app3_total,top_user_app3_from:top4_user_app3_from.toLocaleString(),top_user_app3_until:top4_user_app3_until.toLocaleString()}),resolve_cnt+=1})})),4===i&&(complete_count+=2,UserInGroupData.getUserInGroupActiveFlows(hostname,e.name).then(function(user_in_group_flow_data){UserInGroupData.getUserInGroupAppData(hostname,e.name).then(function(user_in_group_app_data){try{(top5_user_app1_from=new Date(user_in_group_app_data.data.collection[0].from)).setHours(top5_user_app1_from.getHours()+9),(top5_user_app1_until=new Date(user_in_group_app_data.data.collection[0].until)).setHours(top5_user_app1_until.getHours()+9)}catch(exception){var top5_user_app1_from="None",top5_user_app1_until="None"}try{(top5_user_app2_from=new Date(user_in_group_app_data.data.collection[1].from)).setHours(top5_user_app2_from.getHours()+9),(top5_user_app2_until=new Date(user_in_group_app_data.data.collection[1].until)).setHours(top5_user_app2_until.getHours()+9)}catch(exception){var top5_user_app2_from="None",top5_user_app2_until="None"}try{(top5_user_app3_from=new Date(user_in_group_app_data.data.collection[2].from)).setHours(top5_user_app3_from.getHours()+9),(top5_user_app3_until=new Date(user_in_group_app_data.data.collection[2].until)).setHours(top5_user_app3_until.getHours()+9)}catch(exception){var top5_user_app3_from="None",top5_user_app3_until="None"}try{top5_user_app1_name=user_in_group_app_data.data.collection[0].name}catch(exception){top5_user_app1_name="None"}try{top5_user_app1_total=(.001*user_in_group_app_data.data.collection[0].total_rate).toFixed(3)}catch(exception){top5_user_app1_total=0}try{top5_user_app2_name=user_in_group_app_data.data.collection[1].name}catch(exception){top5_user_app2_name="None"}try{top5_user_app2_total=(.001*user_in_group_app_data.data.collection[1].total_rate).toFixed(3)}catch(exception){top5_user_app2_total=0}try{top5_user_app3_name=user_in_group_app_data.data.collection[2].name}catch(exception){top5_user_app3_name="None"}try{top5_user_app3_total=(.001*user_in_group_app_data.data.collection[2].total_rate).toFixed(3)}catch(exception){top5_user_app3_total=0}try{(top5_user_from=new Date(e.from)).setHours(top5_user_from.getHours()+9),top5_user_from=top5_user_from.toLocaleString(),(top5_user_until=new Date(e.until)).setHours(top5_user_until.getHours()+9),top5_user_until=top5_user_until.toLocaleString()}catch(exception){top5_user_from="None",top5_user_until="None"}try{top5_user_name=e.name}catch(exception){top5_user_name="None"}try{top5_user_total=(.001*e.total_rate).toFixed(3)}catch(exception){top5_user_total=0}try{top5_user_down=(.001*e.dest_rate).toFixed(3)}catch(exception){top5_user_down=0}try{top5_user_up=(.001*e.source_rate).toFixed(3)}catch(exception){top5_user_up=0}try{top5_user_active_flow=e.active_flows}catch(exception){top5_user_active_flow=0}try{top5_user_packet_disc_rate=e.packet_discard_rate}catch(exception){top5_user_packet_disc_rate=0}try{top5_user_packet_disc=e.packets_discarded}catch(exception){top5_user_packet_disc=0}try{var _history_user_in_group_active_flows_data=user_in_group_flow_data.data.collection[0]._history_active_flows;top5_user_max_flow_data=_.max(_history_user_in_group_active_flows_data,function(history_user_in_grp_active_flows){return history_user_in_grp_active_flows[1]}),top5_user_max_flow=top5_user_max_flow_data[1],top5_user_max_flow_time=new Date(top5_user_max_flow_data[0]).toLocaleString()}catch(exception){top5_user_max_flow=0,top5_user_max_flow_time="none"}top_user_data.push({top_user_name:0!==data.data.collection.length?top5_user_name:"None",top_user_total:0!==data.data.collection.length?top5_user_total:0,top_user_down:0!==data.data.collection.length?top5_user_down:0,top_user_up:0!==data.data.collection.length?top5_user_up:0,top_user_active_flow:0!==data.data.collection.length?top5_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top5_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top5_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top5_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top5_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top5_user_from:"None",top_user_until:0!==data.data.collection.length?top5_user_until:"None",top_user_app1_name:top5_user_app1_name,top_user_app1_total:top5_user_app1_total,top_user_app1_from:top5_user_app1_from.toLocaleString(),top_user_app1_until:top5_user_app1_until.toLocaleString(),top_user_app2_name:top5_user_app2_name,top_user_app2_total:top5_user_app2_total,top_user_app2_from:top5_user_app2_from.toLocaleString(),top_user_app2_until:top5_user_app2_until.toLocaleString(),top_user_app3_name:top5_user_app3_name,top_user_app3_total:top5_user_app3_total,top_user_app3_from:top5_user_app3_from.toLocaleString(),top_user_app3_until:top5_user_app3_until.toLocaleString()}),resolve_cnt+=1})}))}):(top_user_data.push({top_user_name:0!==data.data.collection.length?top1_user_name:"None",top_user_total:0!==data.data.collection.length?top1_user_total:0,top_user_down:0!==data.data.collection.length?top1_user_down:0,top_user_up:0!==data.data.collection.length?top1_user_up:0,top_user_active_flow:0!==data.data.collection.length?top1_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top1_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top1_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top1_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top1_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top1_user_from:"None",top_user_until:0!==data.data.collection.length?top1_user_until:"None",top_user_app1_name:"None",top_user_app1_total:0,top_user_app1_from:"None",top_user_app1_until:"None",top_user_app2_name:"None",top_user_app2_total:0,top_user_app2_from:"None",top_user_app2_until:"None",top_user_app3_name:"None",top_user_app3_total:0,top_user_app3_from:"None",top_user_app3_until:"None"}),top_user_data.push({top_user_name:0!==data.data.collection.length?top2_user_name:"None",top_user_total:0!==data.data.collection.length?top2_user_total:0,top_user_down:0!==data.data.collection.length?top2_user_down:0,top_user_up:0!==data.data.collection.length?top2_user_up:0,top_user_active_flow:0!==data.data.collection.length?top2_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top2_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top2_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top2_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top2_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top2_user_from:"None",top_user_until:0!==data.data.collection.length?top2_user_until:"None",top_user_app1_name:"None",top_user_app1_total:0,top_user_app1_from:"None",top_user_app1_until:"None",top_user_app2_name:"None",top_user_app2_total:0,top_user_app2_from:"None",top_user_app2_until:"None",top_user_app3_name:"None",top_user_app3_total:0,top_user_app3_from:"None",top_user_app3_until:"None"}),top_user_data.push({top_user_name:0!==data.data.collection.length?top3_user_name:"None",top_user_total:0!==data.data.collection.length?top3_user_total:0,top_user_down:0!==data.data.collection.length?top3_user_down:0,top_user_up:0!==data.data.collection.length?top3_user_up:0,top_user_active_flow:0!==data.data.collection.length?top3_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top3_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top3_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top3_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top3_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top3_user_from:"None",top_user_until:0!==data.data.collection.length?top3_user_until:"None",top_user_app1_name:"None",top_user_app1_total:0,top_user_app1_from:"None",top_user_app1_until:"None",top_user_app2_name:"None",top_user_app2_total:0,top_user_app2_from:"None",top_user_app2_until:"None",top_user_app3_name:"None",top_user_app3_total:0,top_user_app3_from:"None",top_user_app3_until:"None"}),top_user_data.push({top_user_name:0!==data.data.collection.length?top4_user_name:"None",top_user_total:0!==data.data.collection.length?top4_user_total:0,top_user_down:0!==data.data.collection.length?top4_user_down:0,top_user_up:0!==data.data.collection.length?top4_user_up:0,top_user_active_flow:0!==data.data.collection.length?top4_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top4_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top4_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top4_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top4_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top4_user_from:"None",top_user_until:0!==data.data.collection.length?top4_user_until:"None",top_user_app1_name:"None",top_user_app1_total:0,top_user_app1_from:"None",top_user_app1_until:"None",top_user_app2_name:"None",top_user_app2_total:0,top_user_app2_from:"None",top_user_app2_until:"None",top_user_app3_name:"None",top_user_app3_total:0,top_user_app3_from:"None",top_user_app3_until:"None"}),top_user_data.push({top_user_name:0!==data.data.collection.length?top5_user_name:"None",top_user_total:0!==data.data.collection.length?top5_user_total:0,top_user_down:0!==data.data.collection.length?top5_user_down:0,top_user_up:0!==data.data.collection.length?top5_user_up:0,top_user_active_flow:0!==data.data.collection.length?top5_user_active_flow:0,top_user_packet_disc_rate:0!==data.data.collection.length?top5_user_packet_disc_rate:0,top_user_packet_disc:0!==data.data.collection.length?top5_user_packet_disc:0,top_user_max_flow:0!==data.data.collection.length?top5_user_max_flow:0,top_user_max_flow_time:0!==data.data.collection.length?top5_user_max_flow_time:0,top_user_from:0!==data.data.collection.length?top5_user_from:"None",top_user_until:0!==data.data.collection.length?top5_user_until:"None",top_user_app1_name:"None",top_user_app1_total:0,top_user_app1_from:"None",top_user_app1_until:"None",top_user_app2_name:"None",top_user_app2_total:0,top_user_app2_from:"None",top_user_app2_until:"None",top_user_app3_name:"None",top_user_app3_total:0,top_user_app3_from:"None",top_user_app3_until:"None"})),_user_in_group_tb.push({user_group_name:elem,user_group_tr:elem===_user_group_tb_data[index].name?_user_group_tb_data[index].total:"none",top_user_data:top_user_data})}).then(function(res){if(0!==data.data.collection.length){for(var i=0;i<_user_in_group_tb.length;i++)_user_in_group_tb[i].top_user_data.sort(function(a,b){return b.top_user_total-a.top_user_total});_user_in_group_tb.sort(function(a,b){return b.user_group_tr-a.user_group_tr})}if(0!==data.data.collection.length){try{_user_in_group_tr_top1.push((.001*data.data.collection[0].total_rate).toFixed(3))}catch(exception){_user_in_group_tr_top1.push(0)}try{_user_in_group_tr_top2.push((.001*data.data.collection[1].total_rate).toFixed(3))}catch(exception){_user_in_group_tr_top2.push(0)}try{_user_in_group_tr_top3.push((.001*data.data.collection[2].total_rate).toFixed(3))}catch(exception){_user_in_group_tr_top3.push(0)}try{_user_in_group_tr_top4.push((.001*data.data.collection[3].total_rate).toFixed(3))}catch(exception){_user_in_group_tr_top4.push(0)}try{_user_in_group_tr_top5.push((.001*data.data.collection[4].total_rate).toFixed(3))}catch(exception){_user_in_group_tr_top5.push(0)}}else _user_in_group_tr_top1.push(0),_user_in_group_tr_top2.push(0),_user_in_group_tr_top3.push(0),_user_in_group_tr_top4.push(0),_user_in_group_tr_top5.push(0);_user_in_group_label.push("["+elem+"] - ( 1. "+top1_user_name+" , 2. "+top2_user_name+" , 3. "+top3_user_name+" , 4. "+top4_user_name+" , 5. "+top5_user_name+" )")})})});var _user_in_group_tr_data=[_user_in_group_tr_top1,_user_in_group_tr_top2,_user_in_group_tr_top3,_user_in_group_tr_top4,_user_in_group_tr_top5],_user_in_group_series=["TOP 1","TOP 2","TOP 3","TOP 4","TOP 5"],_user_in_group_option={scales:{xAxes:[{ticks:{fontSize:12,fontStyle:"bold"},scaleLabel:{display:!0,fontSize:14,labelString:"유저 사용량(Mbit/s)",fontStyle:"bold"}}],yAxes:[{pointLabelFontSize:20,ticks:{fontSize:12,fontStyle:"bold",autoSkip:!1,userCallback:function(value,index,values){var start=value.indexOf("["),end=value.indexOf("]");return value.substr(start+1,end-1)}},scaleLabel:{display:!0,fontSize:14,labelString:"그룹 내 유저(Top1,Top2,Top3,Top4,Top5)",fontStyle:"bold"}}]},tooltips:{callbacks:{title:function(tooltipItems,data){return data.labels[tooltipItems[0].index]}}}};deferred.resolve({user_group:{_user_group_label:_user_group_label,_user_group_data:_user_group_data,_user_group_series:_user_group_series,_user_group_option:_user_group_option,_user_group_colors:_user_group_colors,_user_group_size:_user_group_size,_user_group_tb_data:_user_group_tb_data},user_in_group:{_user_in_group_tb:_user_in_group_tb,_group_name_tb:_group_name_tb,_user_in_group_tr_data:_user_in_group_tr_data,_user_in_group_label:_user_in_group_label,_user_in_group_series:_user_in_group_series,_user_in_group_option:_user_in_group_option,_user_in_group_colors:_user_group_colors},complete_count:complete_count})})})}),deferred.promise}}}),reportApp.service("ReportUserGroupSize",function($window,$q,ReportData){return function(){this.q_userGroupSize=function(){var deferred=$q.defer();return ReportData.getUserGroupSize().then(function(data){var group_size=data.data.size;deferred.resolve({group_size:group_size})}),deferred.promise}}}),reportApp.service("SharedData",function(){var sharedData={};return sharedData.currentDurationState=!0,sharedData.currentBtnState=!1,sharedData.currentState=!0,sharedData.from,sharedData.until,sharedData.select2model,sharedData.report_type,sharedData.group_size=0,sharedData.errorCode={user:{E01:"ERROR - 유저 데이터를 가져오지 못했습니다.",E02:"ERROR - 유저 ActiveFlows데이터를 가져오지 못했습니다.",E03:"ERROR - 유저 사이즈를 가져오지 못했습니다.",E04:"ERROR - 유저 패킷 제어양 데이터를 가져오지 못했습니다.",E05:"ERROR - 유저-앱 연관 데이터를 가져오지 못했습니다.",W01:"WARN - 유저 데이터가 존재하지 않습니다.",W02:"WARN - 유저 ActiveFlows데이터가 존재하지 않습니다.",W03:"WARN - 유저 사이즈가 존재하지 않습니다.",W04:"WARN - 유저 패킷 제어양 데이터가 존재하지 않습니다.",W05:"WARN - 유저-앱 연관 데이터가 존재하지 않습니다."},interface:{E01:"ERROR - 인터페이스 이름을 가져오지 못했습니다.",E02:"ERROR - 인터페이스 송신 데이터를 가져오지 못했습니다.",E03:"ERROR - 인터페이스 수신 데이터를 가져오지 못했습니다.",W01:"WARN - 인터페이스 이름을 가져오지 못했습니다.",W02:"WARN - 인터페이스 송신 데이터가 존재하지 않습니다.",W03:"WARN - 인터페이스 수신 데이터가 존재하지 않습니다."},user_group:{E01:"ERROR - 유저그룹 데이터를 가져오지 못했습니다.",E02:"ERROR - 유저그룹 ActiveFlows 데이터를 가져오지 못했습니다.",E03:"ERROR - 유저 그룹 사이즈를 가져오지 못했습니다.",E04:"ERROR - 그룹 내에 유저의 ActiveFlows 데이터를 가져오지 못했습니다.",E05:"ERROR - 그룹 내에 유저-앱 연관 데이터를 가져오지 못했습니다.",W01:"WARN - 유저그룹 데이터가 존재하지 않습니다.",W02:"WARN - 유저그룹 ActiveFlows 데이터가 존재하지 않습니다.",W03:"WARN - 유저 그룹 사이즈가 존재하지 않습니다.",W04:"WARN - 그룹 내에 유저의 ActiveFlows 데이터가 존재하지 않습니다.",W05:"WARN - 그룹 내에 유저-앱 연관 데이터가 존재하지 않습니다."},metadata:{E01:"ERROR - 메타 데이터를 가져오지 못했습니다.",W01:"WARN - 메타 데이터가 존재하지 않습니다."}},{setCurrentState:function(arg){sharedData.currentState=arg},getCurrentState:function(){return sharedData.currentState},getSharedData:function(){return sharedData},setFrom:function(from){sharedData.from=from},setUntil:function(until){sharedData.until=until},getFrom:function(){return sharedData.from},getUntil:function(){return sharedData.until},setSelect2model:function(data){sharedData.select2model=data},getSelect2model:function(){return sharedData.select2model},setReportType:function(data){sharedData.report_type=data},getReportType:function(){return sharedData.report_type},setGroupSize:function(size){sharedData.group_size=size},getGroupSize:function(){return sharedData.group_size},getErrorCode:function(){return sharedData.errorCode}}}),reportApp.factory("ReportData",function($http,$log,$base64,$window,ReportFrom,ReportUntil,ReportUrl,ReportQstring,ReportAuth,ReportConfig,SharedData,Notification){var from=SharedData.getFrom(),until=SharedData.getUntil(),errorCode=SharedData.getErrorCode();$.ajaxSetup({async:!1});var result,config=($.getJSON("./config/report-config.json",function(d){result=d.config}),result);$.ajaxSetup({async:!0});var rest_from=new ReportFrom("").setFrom(from).getFrom(),rest_until=new ReportUntil("").setUntil(until).getUntil(),headers=new ReportAuth("").addId(config.common.id).addPasswd(config.common.passwd).getAuth();return{getMetaLink:function(){var meta_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.metapath).addSection("").addQstring("").getUrls();return $http({method:"GET",url:meta_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.metadata.E01)})},getInterfaceName:function(hostname){var int_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection("interfaces/").addQstring("?token=1&order=%3Eactual_direction&with=actual_direction=external,class%3C=ethernet_interface&start=0&limit=10&select=name,type,actual_direction,peer,state,description").getUrls();return $http({method:"GET",url:int_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.interface.E01)})},getExtInterfaceNameWithSpan:function(hostname){var int_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection("interfaces/").addQstring("?token=1&order=%3Eactual_direction&with=actual_direction=external,span_port=true,class%3C=ethernet_interface,&start=0&limit=10&select=name,type,actual_direction,state,description,span_port").getUrls();return $http({method:"GET",url:int_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.interface.E01)})},getIntInterfaceNameWithSpan:function(hostname){var int_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection("interfaces/").addQstring("?token=1&order=%3Eactual_direction&with=actual_direction=internal,span_port=true,class%3C=ethernet_interface,&start=0&limit=10&select=name,type,actual_direction,state,description,span_port").getUrls();return $http({method:"GET",url:int_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.interface.E01)})},getIntRcvData:function(hostname,int_name){var rest_qstring=new ReportQstring("").addSelect("?select="+config.interface_rcv.attr).addFrom("&from="+rest_from).addOrder("&operation="+config.interface_rcv.operation).addLimit("&history_points="+config.interface_rcv.hist_point).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.interface_rcv.section.replace(":int_name",int_name)).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.interface.E03)})},getIntTrsData:function(hostname,int_name){var rest_qstring=new ReportQstring("").addSelect("?select="+config.interface_trs.attr).addFrom("&from="+rest_from).addOrder("&operation="+config.interface_trs.operation).addLimit("&history_points="+config.interface_trs.hist_point).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.interface_trs.section.replace(":int_name",int_name)).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.interface.E02)})},getUserData:function(hostname){var rest_qstring=new ReportQstring("").addSelect("?select="+config.users_tr.attr).addOrder("&order="+config.users_tr.order).addLimit("&limit="+config.users_tr.limit).addWith("&with="+config.users_tr.with).addFrom("&from="+rest_from).addOperation("&operation="+config.users_tr.operation).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.users_tr.section).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.user.E01)})},getUserActiveFlows:function(hostname){var rest_qstring=new ReportQstring("").addSelect("?select="+config.users_active_flows.attr).addFrom("&from="+rest_from).addOperation("&operation=raw").addHistPoint("&history_points="+config.users_active_flows.hist_point).addLimit("&limit="+config.users_active_flows.limit).addOrder("&order="+config.users_active_flows.order).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.users_tr.section).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.user.E02)})},getUserGroupSize:function(hostname){var rest_qstring=new ReportQstring("").addLimit("?limit=0").getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.user_group_tr.section).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.user_group.E03)})},getUserGroupData:function(hostname,group_size){var rest_qstring=new ReportQstring("").addSelect("?select="+config.user_group_tr.attr).addOrder("&order="+config.user_group_tr.order).addLimit("&limit="+group_size).addFrom("&from="+rest_from).addOperation("&operation="+config.user_group_tr.operation).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.user_group_tr.section).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){if(0!==data.data.collection.length)return data;Notification.error(errorCode.user_group.W01)},function(response){response.status<0&&Notification.error(errorCode.user_group.E01)})},getUserGroupActiveFlows:function(hostname,size){var rest_qstring=new ReportQstring("").addSelect("?select="+config.user_group_active_flows.attr).addFrom("&from="+rest_from).addOperation("&operation=raw").addHistPoint("&history_points="+config.user_group_active_flows.hist_point).addLimit("&limit="+size).addOrder("&order="+config.user_group_active_flows.order).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.user_group_active_flows.section).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.user_group.E02)})}}}),reportApp.factory("ReportMain",function($http,$log,$base64,$window,ReportFrom,ReportUntil,ReportUrl,ReportQstring,ReportAuth,ReportConfig,SharedData,Notification){var from=SharedData.getFrom(),until=SharedData.getUntil(),errorCode=SharedData.getErrorCode();$.ajaxSetup({async:!1});var result,config=($.getJSON("./config/report-config.json",function(d){result=d.config}),result);$.ajaxSetup({async:!0});new ReportFrom("").setFrom(from).getFrom(),new ReportUntil("").setUntil(until).getUntil();var headers=new ReportAuth("").addId(config.common.id).addPasswd(config.common.passwd).getAuth();return{getMetaLink:function(){var meta_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.metapath).addSection("").addQstring("").getUrls();return $http({method:"GET",url:meta_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.metadata.E01)})},getInterfaceName:function(hostname){var int_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection("interfaces/").addQstring("?token=1&order=%3Eactual_direction&with=actual_direction=external,class%3C=ethernet_interface&start=0&limit=10&select=name,type,actual_direction,state,description").getUrls();return $http({method:"GET",url:int_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.interface.E01)})},getUserSize:function(hostname){var rest_qstring=new ReportQstring("").addLimit("?limit=0").getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.users_tr.section).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.user.E03)})},getUserGroupSize:function(hostname){var rest_qstring=new ReportQstring("").addLimit("?limit=0").getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.user_group_tr.section).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.user_group.E03)})}}}),reportApp.factory("UserAppData",function($http,$log,$base64,$window,ReportConfig,ReportFrom,ReportUntil,ReportUrl,ReportQstring,ReportAuth,SharedData){var from=SharedData.getFrom(),until=SharedData.getUntil(),errorCode=SharedData.getErrorCode();$.ajaxSetup({async:!1});var result,config=($.getJSON("./config/report-config.json",function(d){result=d.config}),result);return $.ajaxSetup({async:!0}),{getUserAppData:function(hostname,userid){var rest_from=new ReportFrom("").setFrom(from).getFrom(),rest_until=new ReportUntil("").setUntil(until).getUntil(),rest_qstring=new ReportQstring("").addSelect("?select="+config.user_app.attr).addOrder("&order="+config.user_app.order).addLimit("&limit="+config.user_app.limit).addWith("&with="+config.user_app.with).addFrom("&from="+rest_from).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.user_app.section.replace(":userID",userid)).addQstring(rest_qstring).getUrls(),headers=new ReportAuth("").addId(config.common.id).addPasswd(config.common.passwd).getAuth();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){if(0!==data.data.collection.length)return data;Notification.error(errorCode.user.W05)},function(response){response.status<0&&Notification.error(errorCode.user.E05)})}}}),reportApp.factory("UserInGroupData",function($http,$log,$base64,$window,ReportConfig,ReportFrom,ReportUntil,ReportUrl,ReportQstring,ReportAuth,SharedData,Notification){var from=SharedData.getFrom(),until=SharedData.getUntil(),errorCode=SharedData.getErrorCode();$.ajaxSetup({async:!1});var result,config=($.getJSON("./config/report-config.json",function(d){result=d.config}),result);$.ajaxSetup({async:!0});var rest_from=new ReportFrom("").setFrom(from).getFrom(),rest_until=new ReportUntil("").setUntil(until).getUntil(),headers=new ReportAuth("").addId(config.common.id).addPasswd(config.common.passwd).getAuth();return{getUserInGroupActiveFlows:function(hostname,user_name){var rest_qstring=new ReportQstring("").addSelect("?select="+config.user_in_group_active_flows.attr).addFrom("&from="+rest_from).addOperation("&operation=raw").addHistPoint("&history_points="+config.user_in_group_active_flows.hist_point).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.user_in_group_active_flows.section.replace(":user_name",user_name)).addQstring(rest_qstring).getUrls();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return data},function(response){response.status<0&&Notification.error(errorCode.user.E04)})},getUserInGroupAppData:function(hostname,userid){var rest_from=new ReportFrom("").setFrom(from).getFrom(),rest_until=new ReportUntil("").setUntil(until).getUntil(),rest_qstring=new ReportQstring("").addSelect("?select="+config.user_app.attr).addOrder("&order="+config.user_app.order).addLimit("&limit="+config.user_app.limit).addWith("&with="+config.user_app.with).addFrom("&from="+rest_from).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.user_app.section.replace(":userID",userid)).addQstring(rest_qstring).getUrls(),headers=new ReportAuth("").addId(config.common.id).addPasswd(config.common.passwd).getAuth();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){if(0!==data.data.collection.length)return data;Notification.error(errorCode.user.W05)},function(response){response.status<0&&Notification.error(errorCode.user.E05)})},getUserInGroupData:function(hostname,user_group_name){var rest_from=new ReportFrom("").setFrom(from).getFrom(),rest_until=new ReportUntil("").setUntil(until).getUntil(),rest_qstring=new ReportQstring("").addSelect("?select="+config.user_in_group_tr.attr).addOrder("&order="+config.user_in_group_tr.order).addLimit("&limit="+config.user_in_group_tr.limit).addOperation("&operation="+config.user_in_group_tr.operation).addFrom("&from="+rest_from).addUntil("&until="+rest_until).getQstring(),rest_url=new ReportUrl("").addDefault(config.common.ip,config.common.port,config.common.path.replace(":hostname",hostname)).addSection(config.user_in_group_tr.section.replace(":user_group_name",user_group_name)).addQstring(rest_qstring).getUrls(),headers=new ReportAuth("").addId(config.common.id).addPasswd(config.common.passwd).getAuth();return $http({method:"GET",url:rest_url,headers:headers}).then(function(data,status,headers,config){return 0===data.data.collection.length?(Notification.error({message:"WARN - "+user_group_name+"그룹 내에 유저 데이터가 존재하지 않습니다.",delay:3e4}),data):data},function(response){response.status<0&&Notification.error("ERROR - "+user_group_name+"그룹 내 유저 데이터를 받아 올 수 없습니다.")})}}});